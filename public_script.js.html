<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>public/script.js</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="",baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body class="dark" data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a href="/" class="sidebar-title sidebar-title-anchor">Home</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="gwJXPMzkv2YqXYt5XaCFi"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="app.html">app</a></div><div class="sidebar-section-children"><a href="io.html">io</a></div><div class="sidebar-section-children"><a href="myPeer.html">myPeer</a></div><div class="sidebar-section-children"><a href="peerApp.html">peerApp</a></div><div class="sidebar-section-children"><a href="server.html">server</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="Tec9YlACWbcPHR64mdMx-"><div>Events</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="app.html#event:get">get</a></div><div class="sidebar-section-children"><a href="app.html#event:get">get</a></div><div class="sidebar-section-children"><a href="app.html#event:get">get</a></div><div class="sidebar-section-children"><a href="app.html#event:set">set</a></div><div class="sidebar-section-children"><a href="app.html#event:use">use</a></div><div class="sidebar-section-children"><a href="app.html#event:use">use</a></div><div class="sidebar-section-children"><a href="app.html#event:use">use</a></div><div class="sidebar-section-children"><a href="camera.html#event:start">start</a></div><div class="sidebar-section-children"><a href="hands.html#event:onResults">onResults</a></div><div class="sidebar-section-children"><a href="hands.html#event:setOptions">setOptions</a></div><div class="sidebar-section-children"><a href="io.html#event:connect">connect</a></div><div class="sidebar-section-children"><a href="io.html#event:on">on</a></div><div class="sidebar-section-children"><a href="myPeer.html#event:on">on</a></div><div class="sidebar-section-children"><a href="myPeer.html#event:on">on</a></div><div class="sidebar-section-children"><a href="peerApp.html#event:use">use</a></div><div class="sidebar-section-children"><a href="global.html#peerServer#event:listen">listen</a></div><div class="sidebar-section-children"><a href="server.html#event:listen">listen</a></div><div class="sidebar-section-children"><a href="socket.html#event:on">on</a></div><div class="sidebar-section-children"><a href="socket.html#event:on">on</a></div><div class="sidebar-section-children"><a href="socket.html#event:on">on</a></div><div class="sidebar-section-children"><a href="socket.html#event:on">on</a></div><div class="sidebar-section-children"><a href="socket.html#event:on">on</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="CSUbEAP_r9Qm6S83PRws0"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#addVideoStream">addVideoStream</a></div><div class="sidebar-section-children"><a href="global.html#connectToNewUser">connectToNewUser</a></div><div class="sidebar-section-children"><a href="global.html#cors">cors</a></div><div class="sidebar-section-children"><a href="global.html#currentPeer">currentPeer</a></div><div class="sidebar-section-children"><a href="global.html#detect_fingersup">detect_fingersup</a></div><div class="sidebar-section-children"><a href="global.html#express">express</a></div><div class="sidebar-section-children"><a href="global.html#ExpressPeerServer">ExpressPeerServer</a></div><div class="sidebar-section-children"><a href="global.html#findhandpos">findhandpos</a></div><div class="sidebar-section-children"><a href="global.html#Gesture">Gesture</a></div><div class="sidebar-section-children"><a href="global.html#gesturesEnabled">gesturesEnabled</a></div><div class="sidebar-section-children"><a href="global.html#muteUnmute">muteUnmute</a></div><div class="sidebar-section-children"><a href="global.html#myVideo">myVideo</a></div><div class="sidebar-section-children"><a href="global.html#myVideoStream">myVideoStream</a></div><div class="sidebar-section-children"><a href="global.html#onGestureAction">onGestureAction</a></div><div class="sidebar-section-children"><a href="global.html#onResults">onResults</a></div><div class="sidebar-section-children"><a href="global.html#peers">peers</a></div><div class="sidebar-section-children"><a href="global.html#peerServer">peerServer</a></div><div class="sidebar-section-children"><a href="global.html#playStop">playStop</a></div><div class="sidebar-section-children"><a href="global.html#RateLimit">RateLimit</a></div><div class="sidebar-section-children"><a href="global.html#roomHostsMap">roomHostsMap</a></div><div class="sidebar-section-children"><a href="global.html#roomParticipantsMap">roomParticipantsMap</a></div><div class="sidebar-section-children"><a href="global.html#screenSharing">screenSharing</a></div><div class="sidebar-section-children"><a href="global.html#screenStream">screenStream</a></div><div class="sidebar-section-children"><a href="global.html#scrollToBottom">scrollToBottom</a></div><div class="sidebar-section-children"><a href="global.html#setDisableGestures">setDisableGestures</a></div><div class="sidebar-section-children"><a href="global.html#setEnableGestures">setEnableGestures</a></div><div class="sidebar-section-children"><a href="global.html#setMuteButton">setMuteButton</a></div><div class="sidebar-section-children"><a href="global.html#setPlayVideo">setPlayVideo</a></div><div class="sidebar-section-children"><a href="global.html#setStopVideo">setStopVideo</a></div><div class="sidebar-section-children"><a href="global.html#setUnmuteButton">setUnmuteButton</a></div><div class="sidebar-section-children"><a href="global.html#startScreenShare">startScreenShare</a></div><div class="sidebar-section-children"><a href="global.html#stopScreenSharing">stopScreenSharing</a></div><div class="sidebar-section-children"><a href="global.html#toggleChat">toggleChat</a></div><div class="sidebar-section-children"><a href="global.html#toggleGesture">toggleGesture</a></div><div class="sidebar-section-children"><a href="global.html#videoGrid">videoGrid</a></div><div class="sidebar-section-children"><a href="global.html#.onchange">.onchange</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section id="source-page" class="source-page"><header><h1 id="title" class="has-anchor">public_script.js</h1></header><article><pre class="prettyprint source lang-js"><code>/*
 * Copyright (C) 2022 Kraft, Royapally, Sarthi, Ramaswamy, Maduru, Harde, Gomes, Bellam, Reddy, Craine, Gupta - All Rights Reserved
 * You may use, distribute and modify this code under the
 * terms of the MIT license that can be found in the LICENSE file or
 * at https://opensource.org/licenses/MIT.
 * You should have received a copy of the MIT license with
 * this file. If not, please write to: develop.nak@gmail.com, or visit https://github.com/SiddarthR56/spark/blob/main/README.md.
 */

/**
 * Logic for setting and starting up the client-side of Spark, which includes room controls
 * for both broadcasting and the individual, as well as hand gesture handling
 *
 * Dependencies are provided by room.ejs through CDN links and direct links.
 *
 * @requires mediapipe (camera_utils, control_utils, drawing_utils, hands)
 * @requires peer
 * @requires socket.io
 * @requires hand_gesture (Spark's hand_gesture.js file)
 * @requires server (Spark's server.js file)
 */

/**
 * The client-side socket object that will connect to the server
 *
 * @type {Object}
 * @param {string} [path] Endpoint to connect to the associated server where io.connect is
 * @const
 * @method
 *
 * @event io#connect
 * @listens socket#on
 * @fires socket#emit
 */
const socket = io.connect('/');
/**
 * The grid of local and remote video objects representing the video of all peers.
 *
 * @const
 */

const videoGrid = document.getElementById('video-grid');

/**
 * Instance of the client-side peer with which to communicate with other peers.
 *
 * @type {Object}
 * @constructor
 * @param {string} [id] Other peers can connect to this peer using the provided ID. If no ID is given, one will be generated by the brokering server.
 * @param {Object} [options] Options for setting up the peer connection; required
 * @listens myPeer#on
 */
const myPeer = new Peer(undefined, {
  config: { iceServers: [{ url: 'stun:stun.l.google.com:19302' }] },
  path: '/peerjs', // Points to server.js /peerjs endpoint
  host: '/', // This means it points to localhost
  port: '3001', // Points to {host}:3001
});

/**
 * Reference to the local video stream for the client.
 *
 * @type {Object}
 */

let myVideoStream;

/**
 * Reference to the created (local) video object
 *
 * @const
 */
const myVideo = document.createElement('video');

// Mute video by default
myVideo.muted = true;
/**
 * Container for all connected peers in the room.
 *
 * @const
 */
const peers = {};
/**
 * Reference to the most recently connected peer.
 *
 * @type {Object}
 */
var currentPeer = null;

/**
 * Boolean for toggling whether or not gestures are enabled. Default disabled.
 *
 * @type {boolean}
 */
var gesturesEnabled = false;

// Prompts the user for access to the video camera and audio. Once permitted,
// will fire off the rest of the startup event listeners for the client
navigator.mediaDevices
  .getUserMedia({
    video: true,
    audio: true,
  })
  .then((stream) => {
    myVideoStream = stream; // Saves the stream that was permitted to use to the local stream ref
    addVideoStream(myVideo, stream); // Adds the local video object to the video grid

    const hands = new Hands({
      locateFile: (file) => {
        return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
      },
    });
    /**
     * Sets other explicit configs for how the hands will detect gestures.
     *
     * @method
     * @param {Object} [options] Options object to set
     * @event hands#setOptions
     */
    hands.setOptions({
      maxNumHands: 1,
      modelComplexity: 1,
      minDetectionConfidence: 0.8,
      minTrackingConfidence: 0.7,
    });
    /**
     * Sets up the onResults callback function.
     *
     * @method
     * @param {function} [callback] The callback function to pass gesture results to
     * @event hands#onResults
     */
    hands.onResults(onGestureAction);

    /**
     * Instantiates the mediapipe camera object to read off the local video HTML element.
     *
     * @const
     * @constructor
     * @param {Object} [videoObject] Video object to process frame-by-frame operations on
     * @param {Object} [options] Options for how the camera will interact with (or modify) the videoObject on start
     * @fires camera#start
     */
    const camera = new Camera(myVideo, {
      onFrame: async () => {
        if (gesturesEnabled) await hands.send({ image: myVideo });
      },
      width: myVideo.videoWidth,
      height: myVideo.videoHeight,
    });
    /**
     * Triggers the camera to start interacting with (or modifying) the video object based on provided options.
     *
     * @event camera#start
     */
    camera.start();

    /**
     * Handles what happens when a new peer uses call().
     *
     * @event myPeer#on
     */
    myPeer.on('call', (call) => {
      // Answer the call with the stream object for process
      call.answer(stream);
      // Sets the newly connected peer to the currentPeer var
      currentPeer = call;
      // Create the new video HTML element for the peer
      const video = document.createElement('video');
      // When the connecting peer recieves the answer from other peers
      // tell them to add to their video element to the grid. Effectively
      // makes it work for >2 peers
      call.on('stream', (userVideoStream) => {
        addVideoStream(video, userVideoStream);
      });
    });

    /**
     * Handles what happens when 'user-connected' is recieved from server.
     *
     * @event socket#on
     */
    socket.on('user-connected', (userId) => {
      console.log('user Joined');
      connectToNewUser(userId, stream);
    });
    // input value fetched by jQuery
    let text = $('input');
    // When a key is pressed when sending a non-empty chat message
    $('html').keydown(function (e) {
      console.log(text.val());
      // Checks to see if the key is enter, and if it is, it emits the message to server
      if (e.which == 13 &amp;&amp; text.val().length !== 0) {
        socket.emit('message', text.val());
        text.val('');
      }
    });

    /**
     * Handles what happens when it recieves 'createMessage' from the server.
     *
     * @event socket#on
     */
    socket.on('createMessage', (message) => {
      console.log(message);
      $('ul').append(`&lt;li class="message">&lt;b>user&lt;/b>&lt;br/>${message}&lt;/li>`);
      scrollToBottom();
    });

    /**
     * Handles what happens when it recieves 'muteAll' from the server.
     * Effectively just runs the mute code.
     *
     * @event socket#on
     */
    socket.on('muteAll', () => {
      myVideoStream.getAudioTracks()[0].enabled = false;
      setUnmuteButton();
    });
  });

/**
 * Handles what happens when 'user-disconnected' is recieved from server.
 * Just calls close on the right peers user ID.
 * @event socket#on
 */
socket.on('user-disconnected', (userId) => {
  if (peers[userId]) peers[userId].close();
});

/**
 * Handles what happens when a new peer connects.
 *
 * @event myPeer#on
 */
myPeer.on('open', (id) => {
  console.log('Opened');
  userId = id; // Sets the userId with the peer's unique internal ID
  socket.emit('join-room', ROOM_ID, id);
});

/**
 * Uses peer.js to add a new peer, along with setting up the
 * listeners for "this" client.
 *
 * @function
 * @param {string} userId User (socket) ID of the new user
 * @param {Object} stream Video stream to add to "this" client's video grid
 */
function connectToNewUser(userId, stream) {
  const call = myPeer.call(userId, stream);
  console.log(call);
  console.log(myPeer);
  const video = document.createElement('video');
  call.on('stream', (userVideoStream) => {
    addVideoStream(video, userVideoStream);
    console.log('user Joined and video added');
  });
  call.on('close', () => {
    videoGrid.removeChild(video);
    video.remove();
  });

  peers[userId] = call;
}

/**
 * Sends the 'filetransfer' signal to the server along with the byte data
 * of the file that was chosen to be submitted by the user.
 *
 * @function
 * @param {Object} event The event object that holds the file data to transfer
 */
document.getElementById('filetransfer').onchange = function (event) {
  var files = event.target.files;
  var filename = files[0].name;
  var extension = files[0].type;

  const blob = new Blob(event.target.files);
  var file = {
    filename: filename,
    extension: extension,
    blob: blob,
  };
  socket.emit('filetransfer', file);
};

/**
 * Handles what happens when 'downloadFile' is recieved from server.
 * Uses DOM manipulation that will trigger the browser to download
 * the recieved blob.
 *
 * @event socket#on
 */
socket.on('downloadFile', (blob) => {
  var blobUrl = URL.createObjectURL(
    new Blob([new Uint8Array(blob.blob).buffer], {
      type: blob.extension,
    })
  );

  // Create a link element
  var link = document.createElement('a');
  var li = document.createElement('li');

  // Set link's href to point to the Blob URL
  link.href = blobUrl;
  link.download = blob.filename;
  li.append(link);
  $('ul').append(li);

  scrollToBottom();
  link.click();
});

/**
 * Adds a new video to the client's video grid, and forcing the stream of the video to play.
 *
 * @function
 * @param {Object} video
 * @param {Object} stream
 */
function addVideoStream(video, stream) {
  console.log('Video adding');
  video.srcObject = stream;
  video.addEventListener('loadedmetadata', () => {
    video.play();
  });
  videoGrid.append(video);
}

/**
 * Scrolls to the bottom of the chat container HTML element
 * to show the latest chat message.
 *
 * @function
 */
const scrollToBottom = () => {
  var d = $('.main__chat_window');
  d.scrollTop(d.prop('scrollHeight'));
};

/**
 * Utilizes DOM manipulation to toggle the chat section of the room.
 *
 * @function
 */
const toggleChat = () => {
  const hideChat = `
  &lt;i class="fas fa-comment-slash">&lt;/i>
  &lt;span>Chat&lt;/span>
  `;

  const ShowChat = `
  &lt;i class="fas fa-comment">&lt;/i>
  &lt;span>Chat&lt;/span>
  `;

  var x = document.getElementById('chat_container');
  if (x.style.display === 'none') {
    x.style.display = 'block';
    document.querySelector('.main__chat_button').innerHTML = ShowChat;
  } else {
    x.style.display = 'none';
    document.querySelector('.main__chat_button').innerHTML = hideChat;
  }
};

/**
 * Utilizes DOM manipulation to display the mute button
 * on the mute/unmute button container.
 *
 * @function
 */
const setMuteButton = () => {
  const html = `
    &lt;i class="fas fa-microphone">&lt;/i>
    &lt;span>Mute&lt;/span>
  `;
  document.querySelector('.main__mute_button').innerHTML = html;
};

/**
 * Utilizes DOM manipulation to display the unmute button
 * on the mute/unmute button container.
 *
 * @function
 */
const setUnmuteButton = () => {
  const html = `
    &lt;i class="unmute fas fa-microphone-slash">&lt;/i>
    &lt;span>Unmute&lt;/span>
  `;
  document.querySelector('.main__mute_button').innerHTML = html;
};

/**
 * Utilizes DOM manipulation to display the stop video button
 * on the video show/stop button container.
 *
 * @function
 */
const setStopVideo = () => {
  const html = `
    &lt;i class="fas fa-video">&lt;/i>
    &lt;span>Stop Video&lt;/span>
  `;
  document.querySelector('.main__video_button').innerHTML = html;
};

/**
 * Utilizes DOM manipulation to display the show video button
 * on the video show/stop button container.
 *
 * @function
 */
const setPlayVideo = () => {
  const html = `
  &lt;i class="stop fas fa-video-slash">&lt;/i>
    &lt;span>Play Video&lt;/span>
  `;
  document.querySelector('.main__video_button').innerHTML = html;
};

/**
 * Utilizes DOM manipulation to display the enable gesture button
 * on the gesture enable/disable button container.
 *
 * @function
 */
const setEnableGestures = () => {
  const html = `
    &lt;i class="far fa-hand-paper">&lt;/i>
    &lt;span>Enable Gestures&lt;/span>
  `;
  document.querySelector('.main__gestures__button').innerHTML = html;
};

/**
 * Utilizes DOM manipulation to display the disable gesture button
 * on the gesture enable/disable button container.
 *
 * @function
 */
const setDisableGestures = () => {
  const html = `
    &lt;i class="fas fa-hand-paper">&lt;/i>
    &lt;span>Disable Gestures&lt;/span>
  `;
  document.querySelector('.main__gestures__button').innerHTML = html;
};

/**
 * Toggles the mute and unmute of the video stream, along with setting
 * the mute and unmute button by calling their defined functions.
 *
 * @function
 */
const muteUnmute = () => {
  const enabled = myVideoStream.getAudioTracks()[0].enabled;
  if (enabled) {
    myVideoStream.getAudioTracks()[0].enabled = false;
    setUnmuteButton();
  } else {
    setMuteButton();
    myVideoStream.getAudioTracks()[0].enabled = true;
  }
};

/**
 * Toggles the show and hide of the video stream, along with setting
 * the show and hide video buttons by calling their defined functions.
 *
 * @function
 */
const playStop = () => {
  console.log('object');
  let enabled = myVideoStream.getVideoTracks()[0].enabled;
  if (enabled) {
    myVideoStream.getVideoTracks()[0].enabled = false;
    setPlayVideo();
  } else {
    setStopVideo();
    myVideoStream.getVideoTracks()[0].enabled = true;
  }
};

/**
 * Toggles the detection of gestures in the video stream, along with setting
 * the enable and disable buttons by calling their defined functions.
 *
 * @function
 */
const toggleGesture = () => {
  if (gesturesEnabled) {
    setEnableGestures();
    gesturesEnabled = false;
  } else {
    setDisableGestures();
    gesturesEnabled = true;
  }
};

/**
 * Boolean for determining if a screen is being shared or not.
 *
 * @type {boolean}
 */
var screenSharing = false;

/**
 * Reference object of the screen sharing video stream.
 *
 * @type {Object}
 */
var screenStream;

/**
 * Changes your video to point to point to your screen sharing video that's prompted.
 * If permitted, it will change your video stream to the screen sharing stream you are
 * doing for all peers that are connected to you.
 * If stopping screen share, see stopScreenSharing function.
 *
 * @function
 */
function startScreenShare() {
  if (screenSharing) {
    stopScreenSharing();
  }
  navigator.mediaDevices.getDisplayMedia({ video: true }).then((stream) => {
    screenStream = stream;
    let videoTrack = screenStream.getVideoTracks()[0];
    videoTrack.onended = () => {
      stopScreenSharing();
    };
    if (myPeer) {
      /* TODO: Change this to not just be for the currentPeer var, but for all peers */
      let sender = currentPeer.peerConnection.getSenders().find(function (s) {
        return s.track.kind == videoTrack.kind;
      });
      sender.replaceTrack(videoTrack);
      screenSharing = true;
    }
    console.log(screenStream);
  });
}

/**
 * Replaces the video stream of the screen sharing to be video stream of the user
 * who stopped the screen sharing.
 *
 * @function
 */
function stopScreenSharing() {
  if (!screenSharing) return;
  let videoTrack = myVideoStream.getVideoTracks()[0];
  if (myPeer) {
    /* TODO: Change this to not just be for the currentPeer var, but for all peers */
    let sender = currentPeer.peerConnection.getSenders().find(function (s) {
      return s.track.kind == videoTrack.kind;
    });
    sender.replaceTrack(videoTrack);
  }
  screenStream.getTracks().forEach(function (track) {
    track.stop();
  });
  screenSharing = false;
}

/// Below are the setting of click event listeners on the corresponding HTML elements for various functionality ///

document.getElementById('mute').addEventListener('click', () => {
  muteUnmute();
});

document.getElementById('playStop').addEventListener('click', () => {
  playStop();
});

document.getElementById('chatButton').addEventListener('click', () => {
  toggleChat();
});

document.getElementById('muteAll').addEventListener('click', () => {
  socket.emit('muteAllUsers', userId, ROOM_ID);
});

document.getElementById('gestureButton').addEventListener('click', () => {
  console.log('gesture click');
  toggleGesture();
});

var screenShare = document.getElementById('share-screen');
screenShare.addEventListener('click', () => {
  if (screenSharing) {
    stopScreenSharing();
  } else {
    startScreenShare();
  }
});

/**
 * Callback for the Hands onResults event to see what gestures
 * came out of that and how to map those gestures to certain room controls.
 *
 * @param {Object} results The hand detection results
 */
function onGestureAction(results) {
  var gesture = onResults(results);
  switch (gesture) {
    case Gesture.RightSwipe:
      {
        // Right swipe means to start screen sharing
        console.log('start share');
        startScreenShare();
      }
      break;
    case Gesture.LeftSwipe:
      {
        // Left swipe means to stop screen sharing
        console.log('end share');
        stopScreenSharing();
      }
      break;
    case Gesture.All5Fingers:
      {
        // Does nothing... for now
      }
      break;
    case Gesture.ThumbsUp:
      {
        // Thumbs up unmutes audio
        console.log('unmute audio');
        muteUnmute();
      }
      break;
    case Gesture.ThumbsDown:
      {
        // Thumbs down mutes audio
        console.log('mute audio');
        muteUnmute();
      }
      break;
    default: {
      // Any other gesture does nothing... for now
    }
  }
}
</code></pre></article></section></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a href="/" class="sidebar-title sidebar-title-anchor">Home</a><div class="mobile-nav-links"></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="gwJXPMzkv2YqXYt5XaCFi"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="app.html">app</a></div><div class="sidebar-section-children"><a href="io.html">io</a></div><div class="sidebar-section-children"><a href="myPeer.html">myPeer</a></div><div class="sidebar-section-children"><a href="peerApp.html">peerApp</a></div><div class="sidebar-section-children"><a href="server.html">server</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="Tec9YlACWbcPHR64mdMx-"><div>Events</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="app.html#event:get">get</a></div><div class="sidebar-section-children"><a href="app.html#event:get">get</a></div><div class="sidebar-section-children"><a href="app.html#event:get">get</a></div><div class="sidebar-section-children"><a href="app.html#event:set">set</a></div><div class="sidebar-section-children"><a href="app.html#event:use">use</a></div><div class="sidebar-section-children"><a href="app.html#event:use">use</a></div><div class="sidebar-section-children"><a href="app.html#event:use">use</a></div><div class="sidebar-section-children"><a href="camera.html#event:start">start</a></div><div class="sidebar-section-children"><a href="hands.html#event:onResults">onResults</a></div><div class="sidebar-section-children"><a href="hands.html#event:setOptions">setOptions</a></div><div class="sidebar-section-children"><a href="io.html#event:connect">connect</a></div><div class="sidebar-section-children"><a href="io.html#event:on">on</a></div><div class="sidebar-section-children"><a href="myPeer.html#event:on">on</a></div><div class="sidebar-section-children"><a href="myPeer.html#event:on">on</a></div><div class="sidebar-section-children"><a href="peerApp.html#event:use">use</a></div><div class="sidebar-section-children"><a href="global.html#peerServer#event:listen">listen</a></div><div class="sidebar-section-children"><a href="server.html#event:listen">listen</a></div><div class="sidebar-section-children"><a href="socket.html#event:on">on</a></div><div class="sidebar-section-children"><a href="socket.html#event:on">on</a></div><div class="sidebar-section-children"><a href="socket.html#event:on">on</a></div><div class="sidebar-section-children"><a href="socket.html#event:on">on</a></div><div class="sidebar-section-children"><a href="socket.html#event:on">on</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="CSUbEAP_r9Qm6S83PRws0"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#addVideoStream">addVideoStream</a></div><div class="sidebar-section-children"><a href="global.html#connectToNewUser">connectToNewUser</a></div><div class="sidebar-section-children"><a href="global.html#cors">cors</a></div><div class="sidebar-section-children"><a href="global.html#currentPeer">currentPeer</a></div><div class="sidebar-section-children"><a href="global.html#detect_fingersup">detect_fingersup</a></div><div class="sidebar-section-children"><a href="global.html#express">express</a></div><div class="sidebar-section-children"><a href="global.html#ExpressPeerServer">ExpressPeerServer</a></div><div class="sidebar-section-children"><a href="global.html#findhandpos">findhandpos</a></div><div class="sidebar-section-children"><a href="global.html#Gesture">Gesture</a></div><div class="sidebar-section-children"><a href="global.html#gesturesEnabled">gesturesEnabled</a></div><div class="sidebar-section-children"><a href="global.html#muteUnmute">muteUnmute</a></div><div class="sidebar-section-children"><a href="global.html#myVideo">myVideo</a></div><div class="sidebar-section-children"><a href="global.html#myVideoStream">myVideoStream</a></div><div class="sidebar-section-children"><a href="global.html#onGestureAction">onGestureAction</a></div><div class="sidebar-section-children"><a href="global.html#onResults">onResults</a></div><div class="sidebar-section-children"><a href="global.html#peers">peers</a></div><div class="sidebar-section-children"><a href="global.html#peerServer">peerServer</a></div><div class="sidebar-section-children"><a href="global.html#playStop">playStop</a></div><div class="sidebar-section-children"><a href="global.html#RateLimit">RateLimit</a></div><div class="sidebar-section-children"><a href="global.html#roomHostsMap">roomHostsMap</a></div><div class="sidebar-section-children"><a href="global.html#roomParticipantsMap">roomParticipantsMap</a></div><div class="sidebar-section-children"><a href="global.html#screenSharing">screenSharing</a></div><div class="sidebar-section-children"><a href="global.html#screenStream">screenStream</a></div><div class="sidebar-section-children"><a href="global.html#scrollToBottom">scrollToBottom</a></div><div class="sidebar-section-children"><a href="global.html#setDisableGestures">setDisableGestures</a></div><div class="sidebar-section-children"><a href="global.html#setEnableGestures">setEnableGestures</a></div><div class="sidebar-section-children"><a href="global.html#setMuteButton">setMuteButton</a></div><div class="sidebar-section-children"><a href="global.html#setPlayVideo">setPlayVideo</a></div><div class="sidebar-section-children"><a href="global.html#setStopVideo">setStopVideo</a></div><div class="sidebar-section-children"><a href="global.html#setUnmuteButton">setUnmuteButton</a></div><div class="sidebar-section-children"><a href="global.html#startScreenShare">startScreenShare</a></div><div class="sidebar-section-children"><a href="global.html#stopScreenSharing">stopScreenSharing</a></div><div class="sidebar-section-children"><a href="global.html#toggleChat">toggleChat</a></div><div class="sidebar-section-children"><a href="global.html#toggleGesture">toggleGesture</a></div><div class="sidebar-section-children"><a href="global.html#videoGrid">videoGrid</a></div><div class="sidebar-section-children"><a href="global.html#.onchange">.onchange</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>